// Полный гид по выбору детского лагеря (12 разделов)
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createServerSupabaseClient } from '@/lib/supabase/server'
import { Navbar } from '@/components/layout/Navbar'
import { Card } from '@/components/ui/Card'
import { Button } from '@/components/ui/Button'
import { 
  MapPin, Shield, Home, Utensils, Calendar, DollarSign, 
  Star, FileText, Backpack, Phone, AlertTriangle, Download,
  Search, Bookmark
} from 'lucide-react'
import { GuideSearch } from './GuideSearch'
import { BookmarkButton } from './BookmarkButton'
import { ExportPDF } from './ExportPDF'

const sections = [
  {
    id: 'section-1',
    title: 'Типы детских лагерей в России',
    icon: MapPin,
    content: {
      intro: 'Детские лагеря в России очень разнообразны. Каждый тип лагеря предлагает свою уникальную программу и атмосферу. Правильный выбор типа лагеря — первый шаг к успешному отдыху ребенка.',
      subsections: [
        {
          title: 'Санаторно-оздоровительные лагеря',
          content: 'Специализируются на укреплении здоровья детей. Расположены в экологически чистых районах, имеют медицинское оборудование и квалифицированный персонал. Программа включает: оздоровительные процедуры (физиотерапия, массаж, ингаляции), лечебную физкультуру, диетическое питание, климатотерапию. Подходят для детей с хроническими заболеваниями (органов дыхания, пищеварения, нервной системы) и для общего укрепления иммунитета. Путевки часто частично оплачиваются государством.',
          examples: 'Примеры: "Орленок" (Краснодарский край), "Артек" (Крым), санатории Кавказских Минеральных Вод.'
        },
        {
          title: 'Спортивные лагеря',
          content: 'Фокусируются на физическом развитии и спортивных достижениях. Бывают профильные (футбол, баскетбол, плавание, теннис, гимнастика) и общеспортивные. Программа: ежедневные тренировки (2-3 раза в день), мастер-классы от профессиональных спортсменов, соревнования и турниры, общая физическая подготовка, теоретические занятия о спорте и здоровье. Подходят активным детям, увлеченным спортом, и тем, кто хочет попробовать новый вид спорта. Требования: медицинская справка о допуске к физическим нагрузкам.',
          examples: 'Примеры: футбольные академии "Чертаново", "Краснодар", теннисные лагеря "Парк теннис".'
        },
        {
          title: 'Языковые лагеря',
          content: 'Программы изучения иностранных языков в игровой форме. Методика: погружение в языковую среду, общение с носителями языка, игры и квесты на иностранном языке, просмотр фильмов и мультфильмов, театральные постановки. Популярные направления: английский (большинство лагерей), немецкий, французский, испанский, китайский. Подходят детям, изучающим язык в школе и желающим практики. Уровни: от начинающих до продвинутых. Результат: преодоление языкового барьера, расширение словарного запаса, улучшение произношения.',
          examples: 'Примеры: English Camp (Подмосковье), Language Link (различные локации).'
        },
        {
          title: 'Творческие лагеря',
          content: 'Развитие художественных талантов и креативности. Направления: театральное мастерство (актерское мастерство, сценическая речь, пластика), музыка (вокал, игра на инструментах, создание группы), танцы (современные, народные, бальные), изобразительное искусство (рисунок, живопись, графика, скульптура), литература и журналистика, кино и видеопроизводство. Программа: мастер-классы от профессионалов, ежедневные репетиции, создание творческих проектов, итоговый концерт или выставка. Подходят детям с творческими способностями и тем, кто хочет попробовать себя в искусстве.',
          examples: 'Примеры: "Театральные каникулы", "Артист", "Кино и театр".'
        },
        {
          title: 'Профильные IT-лагеря',
          content: 'Обучение современным технологиям и программированию. Направления: программирование (Python, JavaScript, C++, создание игр), робототехника (конструирование и программирование роботов), web-разработка (создание сайтов и приложений), 3D-моделирование и дизайн, блогинг и SMM (создание контента для соцсетей), киберспорт. Программа: теоретические занятия, практические проекты, хакатоны, защита итоговых работ. Подходят детям, увлеченным технологиями, и будущим программистам. Результат: конкретный проект (игра, сайт, робот).',
          examples: 'Примеры: "Академия Coding", "РобоЛаб", "GeekSchool".'
        },
        {
          title: 'Палаточные и походные лагеря',
          content: 'Приключения на природе и навыки выживания. Программа: походы (пешие, водные, велосипедные), обустройство лагеря и быта, ориентирование на местности, разведение костра и приготовление пищи, сплавы на байдарках или катамаранах, скалолазание, веревочные курсы. Навыки: самостоятельность, работа в команде, физическая выносливость, уважение к природе. Подходят активным детям старше 10-12 лет, любящим природу. Требования: хорошая физическая подготовка, отсутствие хронических заболеваний.',
          examples: 'Примеры: походные лагеря в Карелии, Алтае, на Урале.'
        },
        {
          title: 'Городские лагеря дневного пребывания',
          content: 'Альтернатива выездным лагерям для младших детей или пробный вариант. Формат: ребенок приходит утром (обычно к 9:00) и уходит вечером (к 18:00), ночует дома. Программа: развивающие занятия, творческие мастер-классы, экскурсии по городу, спортивные игры, прогулки, 2-3-разовое питание. Преимущества: родители рядом, ребенок ночует дома, дешевле выездных лагерей, подходит для первого опыта. Подходят детям 6-10 лет, не готовым к длительной разлуке с родителями.',
          examples: 'Примеры: лагеря при школах, детских центрах, досуговых клубах.'
        }
      ]
    }
  },
  {
    id: 'section-2',
    title: 'Критерии выбора по возрасту',
    icon: Calendar,
    content: {
      intro: 'Возраст ребенка — ключевой фактор при выборе лагеря. Каждый возрастной период имеет свои особенности развития, потребности и возможности.',
      subsections: [
        {
          title: '6-8 лет: Младший школьный возраст',
          content: 'Особенности возраста: только начинают привыкать к самостоятельности, нуждаются в постоянной эмоциональной поддержке, быстро устают, высокая потребность в игре, привязанность к родителям еще сильна. Что важно при выборе лагеря: небольшие отряды (15-20 человек), опытные вожатые с педагогическим образованием, наличие психолога в лагере, игровая программа (минимум учебной нагрузки), короткие смены (7-10 дней для первого раза), возможность родительских звонков, близость к дому (до 2-3 часов езды). Рекомендуемые типы: городские лагеря дневного пребывания, оздоровительные с мягкой программой, творческие с игровым уклоном. Не рекомендуется: палаточные лагеря, длительные смены (более 14 дней), лагеря с интенсивной учебной программой.',
        },
        {
          title: '9-12 лет: Средний школьный возраст',
          content: 'Особенности возраста: растущая самостоятельность, активный интерес к новому, формирование хобби и увлечений, желание дружить и быть частью группы, энергичность и любознательность. Что важно: разнообразная программа (спорт, творчество, развлечения), возможность выбора активностей, квалифицированные инструкторы по интересам, соревновательный элемент, средние отряды (20-25 человек), длительность смены 14-21 день оптимальна. Рекомендуемые типы: спортивные (для активных), творческие (для увлеченных искусством), языковые (если есть интерес), профильные IT (для технически одаренных), оздоровительные с богатой программой. Это идеальный возраст для первого опыта выездного лагеря!',
        },
        {
          title: '13-16 лет: Подростковый возраст',
          content: 'Особенности возраста: стремление к независимости, важность мнения сверстников, поиск себя и своих интересов, критическое мышление, потребность в уважении, могут быть перепады настроения. Что важно: свобода выбора активностей, уважительное отношение вожатых, интересная насыщенная программа, возможность проявить себя, общение с единомышленниками, минимальный контроль (но безопасность), возможность использования гаджетов (в разумных пределах). Рекомендуемые типы: профильные лагеря по интересам (IT, спорт, творчество), языковые (особенно с погружением), приключенческие и палаточные, волонтерские проекты, лидерские программы. Не подходят: лагеря со слишком детской программой, жесткой дисциплиной без объяснений.',
        },
        {
          title: 'Таблица сравнения требований',
          content: '**6-8 лет**: Длительность смены 7-14 дней | Размер отряда 15-20 детей | Тип программы: игровая, развлекательная | Самостоятельность: низкая, нужна помощь | Связь с родителями: ежедневная. **9-12 лет**: Длительность 14-21 день | Размер отряда 20-25 детей | Тип программы: разнообразная, с выбором | Самостоятельность: средняя, растущая | Связь: 2-3 раза в неделю. **13-16 лет**: Длительность 14-21+ дней | Размер отряда 20-30 детей | Тип программы: профильная, интенсивная | Самостоятельность: высокая | Связь: по желанию ребенка, 1-2 раза в неделю.',
        }
      ]
    }
  },
  {
    id: 'section-3',
    title: 'География: популярные регионы',
    icon: MapPin,
    content: {
      intro: 'Россия огромна, и детские лагеря есть практически в каждом регионе. Выбор локации зависит от климата, транспортной доступности, типа отдыха и бюджета.',
      subsections: [
        {
          title: 'Черноморское побережье (Краснодарский край, Крым)',
          content: 'Самое популярное направление для летнего отдыха. Преимущества: теплое море (купальный сезон с июня по сентябрь), мягкий климат, обилие фруктов, развитая инфраструктура, множество экскурсионных возможностей. Популярные локации: Анапа (песчаные пляжи, мелкое море, подходит для младших детей), Геленджик (галечные пляжи, горы), Туапсе и Сочи (субтропики, богатая природа), Крым (Евпатория, Алушта, "Артек"). Стоимость: выше среднего (от 45 000 руб. за смену). Особенности: высокий спрос, бронировать нужно заранее (за 3-4 месяца). Лучшее время: июнь-июль (море уже теплое, еще не жарко). Подходит для: оздоровительных, спортивных, языковых лагерей.',
        },
        {
          title: 'Подмосковье',
          content: 'Удобство и доступность для жителей центральной России. Преимущества: близко к Москве (30-100 км), легко добраться, умеренный климат, леса и озера, много вариантов разных типов лагерей, доступные цены. Популярные направления: Истринский район, Дмитровский район, Рузский район, Можайский район. Стоимость: средняя (от 30 000 руб. за смену). Особенности: нет моря, но много озер и бассейнов, хвойные леса (полезно для дыхательной системы), возможность быстро забрать ребенка при необходимости. Подходит для: всех типов лагерей, особенно IT, творческих, спортивных.',
        },
        {
          title: 'Ленинградская область',
          content: 'Живописная природа Северо-Запада России. Преимущества: уникальная природа (леса, озера, реки), культурная близость к Санкт-Петербургу (экскурсии), свежий воздух, более прохладный климат (комфортно летом). Популярные локации: Карельский перешеек, побережье Ладожского озера, окрестности Выборга. Стоимость: средняя (от 32 000 руб.). Особенности: прохладная погода (не жарко даже летом), много комаров (нужны репелленты), "белые ночи" в июне. Подходит для: палаточных лагерей, приключенческих программ, творческих лагерей.',
        },
        {
          title: 'Алтай и Сибирь',
          content: 'Удивительная природа и приключения. Преимущества: потрясающие горные пейзажи, чистейший воздух, уникальная флора и фауна, приключенческие программы, духовная атмосфера. Популярные локации: Республика Алтай (Чемал, Телецкое озеро), Красноярский край, Байкал. Стоимость: выше средней (из-за транспортных расходов). Особенности: далеко от большинства городов, нужно время на дорогу, горный климат (перепады температур), подходит для старших детей (10+). Подходит для: палаточных лагерей, экологических программ, походов.',
        },
        {
          title: 'Карелия',
          content: 'Край озер и лесов. Преимущества: более 60 000 озер, густые леса, сплавы по рекам, уникальная карельская природа и культура, умеренный климат. Популярные активности: водные походы на байдарках, рыбалка, скалолазание, веревочные курсы, экскурсии к водопадам. Стоимость: средняя. Особенности: много комаров и мошек (июль), прохладная вода в озерах, частые дожди. Подходит для: приключенческих, палаточных, экологических лагерей, детей старше 10 лет.',
        },
        {
          title: 'Интерактивная карта (описание)',
          content: 'На полной версии сайта можно добавить интерактивную карту России с отметками популярных лагерей в каждом регионе. При клике на регион отображается: количество лагерей, средняя стоимость путевки, особенности климата, лучшее время для поездки, типы лагерей. Это поможет визуально оценить географию и выбрать подходящее направление.',
        }
      ]
    }
  },
  {
    id: 'section-4',
    title: 'Безопасность и лицензирование',
    icon: Shield,
    content: {
      intro: 'Безопасность ребенка — главный приоритет при выборе лагеря. Проверка документов и лицензий помогает избежать недобросовестных организаторов и обеспечить спокойствие родителей.',
      subsections: [
        {
          title: 'Какие документы проверять',
          content: 'Обязательные документы лагеря: 1) Лицензия на образовательную деятельность (если лагерь позиционируется как образовательный). 2) Санитарно-эпидемиологическое заключение Роспотребнадзора (подтверждает соответствие санитарным нормам). 3) Заключение МЧС о соответствии противопожарным требованиям. 4) Договор с медицинским учреждением или лицензия на медицинскую деятельность. 5) Свидетельство о государственной регистрации юридического лица (ИНН, ОГРН). 6) Страховой полис гражданской ответственности. Где проверить: попросите копии документов у администрации, проверьте на сайте лагеря (должны быть в открытом доступе), проверьте организацию в ЕГРЮЛ на сайте ФНС. Красные флаги: отказ предоставить документы, просроченные лицензии, новая организация без истории.',
        },
        {
          title: 'Медицинское обеспечение',
          content: 'Что должно быть в лагере: круглосуточный медицинский пункт с врачом или фельдшером, аптечка первой помощи в каждом корпусе, договор с ближайшей больницей для экстренных случаев, изолятор для заболевших детей, возможность вызвать скорую помощь. Вопросы администрации: Есть ли врач в лагере постоянно или по вызову? Как далеко ближайшая больница? Были ли случаи травм и как их решали? Есть ли в лагере дефибриллятор? Как часто осматривают детей? Ребенок с хроническим заболеванием: сообщите об этом заранее, предоставьте подробную медицинскую справку, договоритесь о графике приема лекарств, уточните возможность специальной диеты.',
        },
        {
          title: 'Квалификация персонала',
          content: 'Требования к вожатым: возраст от 18 лет, педагогическое или психологическое образование (желательно), справка об отсутствии судимости, медицинская книжка, прохождение инструктажей по безопасности, опыт работы с детьми (желательно). Вопросы при выборе: Сколько вожатых на отряд? (норма 1 вожатый на 10-15 детей), Какое у них образование?, Проходят ли они обучение перед сменой?, Есть ли старший вожатый с большим опытом? Хорошие признаки: вожатые проходят специальные школы, в лагере работают педагоги на постоянной основе, есть система наставничества для новых вожатых.',
        },
        {
          title: 'Охрана территории',
          content: 'Меры безопасности: огороженная закрытая территория с контролируемым входом/выходом, круглосуточная охрана (ЧОП или собственная служба безопасности), пропускная система для посетителей, видеонаблюдение на территории (опционально), ночные обходы корпусов, тревожная кнопка с выходом на полицию/МЧС. Правила для детей: запрет покидать территорию без разрешения, комендантский час (отбой в определенное время), запрет на прогулки в одиночку, особенно ночью. Спросите: Как организован контроль входа/выхода? Были ли случаи, когда дети уходили с территории? Что делает охрана ночью?',
        },
        {
          title: 'Чек-лист безопасности (скачиваемый)',
          content: '✓ Лицензия на образовательную деятельность проверена | ✓ Санитарное заключение действительно | ✓ Заключение МЧС получено | ✓ В лагере есть медпункт с врачом | ✓ Договор с больницей заключен | ✓ Все вожатые имеют справки об отсутствии судимости | ✓ Соотношение вожатых и детей 1:10-15 | ✓ Территория огорожена и охраняется 24/7 | ✓ Есть пропускная система | ✓ Страховой полис оформлен | ✓ Есть система связи с родителями | ✓ Правила безопасности доведены до детей | ✓ План эвакуации на случай ЧП есть и проведены учения | ✓ Отзывы других родителей положительные | ✓ Вы лично посетили лагерь или виртуальную экскурсию',
        }
      ]
    }
  },
  {
    id: 'section-5',
    title: 'Проживание и питание',
    icon: Home,
    content: {
      intro: 'Условия проживания и качество питания напрямую влияют на комфорт и здоровье ребенка. Важно заранее узнать все детали и убедиться, что они соответствуют вашим ожиданиям.',
      subsections: [
        {
          title: 'Типы размещения',
          content: 'Корпуса (стационарные здания): самый распространенный вариант. Комнаты на 4-8 человек, кровати (часто двухъярусные), тумбочки или шкафы для вещей, общий санузел на этаже (реже в комнате). Преимущества: защита от непогоды, постоянная температура, безопасность. Домики (коттеджи): отдельные небольшие строения. Обычно на 8-12 человек, 2-3 комнаты, свой санузел, более камерная атмосфера. Преимущества: больше приватности, тишина, уют. Палатки: для походных и приключенческих лагерей. 4-6 человек в палатке, спальники и коврики, полевой туалет и умывальники. Преимущества: близость к природе, приключения, закалка. Требует: хорошего здоровья, готовности к спартанским условиям.',
        },
        {
          title: 'Требования к питанию (СанПиН)',
          content: 'Нормы СанПиН для детских лагерей: 5-разовое питание (завтрак, обед, полдник, ужин, второй ужин), калорийность соответствует возрасту (для 7-11 лет — 2400 ккал, для 12-17 лет — 2800 ккал), разнообразное меню (не повторяется в течение 14 дней), обязательное наличие мяса, рыбы, молочных продуктов, овощей и фруктов ежедневно, запрет на: жареное, острое, консервы, газированные напитки, чипсы, соблюдение температурного режима подачи блюд, возможность диетического питания при необходимости. Примерное меню: завтрак (каша, яйцо/сырники, хлеб, масло, чай/какао), обед (салат, суп, второе блюдо с гарниром, компот/сок, хлеб), полдник (выпечка, фрукт, сок/молоко), ужин (салат, второе блюдо, чай, хлеб), второй ужин (кефир, печенье).',
        },
        {
          title: 'Как узнать меню заранее',
          content: 'Способы получить информацию: запросите примерное меню у администрации (они обязаны предоставить), посмотрите на сайте лагеря (часто публикуют типовое меню), почитайте отзывы родителей (они часто пишут о питании), спросите на форумах и в группах в соцсетях, приезжайте на родительский день и посмотрите своими глазами. На что обратить внимание: разнообразие блюд, наличие свежих овощей и фруктов, есть ли выбор (например, два гарнира), как часто дают мясо и рыбу, есть ли выпечка собственного производства.',
        },
        {
          title: 'Аллергии и особое питание',
          content: 'Если у ребенка пищевая аллергия или специальная диета: обязательно сообщите об этом при бронировании, предоставьте медицинскую справку с указанием ограничений, уточните, может ли лагерь обеспечить специальное питание, познакомьтесь с поваром или диетсестрой до смены, дайте ребенку с собой разрешенные перекусы (если лагерь разрешает). Типичные варианты: безглютеновая диета, безлактозная диета, вегетарианство, аллергия на орехи/морепродукты, диабетическое питание. Важно: не все лагеря могут обеспечить специальное питание. Если ограничения серьезные, выбирайте санаторные лагеря с диетическим столом.',
        }
      ]
    }
  },
  {
    id: 'section-6',
    title: 'Программа и распорядок дня',
    icon: Calendar,
    content: {
      intro: 'Программа лагеря и распорядок дня определяют, насколько интересным и полезным будет отдых ребенка. Важно найти баланс между активностями, обучением и отдыхом.',
      subsections: [
        {
          title: 'Как оценить программу',
          content: 'Критерии хорошей программы: разнообразие (спорт, творчество, интеллектуальные игры, развлечения), соответствие возрасту (программа для 7-летних и 14-летних должна различаться), тематичность (каждая смена имеет свою тему или сюжет), вовлеченность детей (дети сами участвуют в планировании), баланс активности и отдыха, кульминационные события (большие мероприятия, концерты, соревнования), возможность выбора (ребенок может выбрать кружки или активности). Спросите: Какая тема смены? Какие крупные мероприятия запланированы? Есть ли свободное время? Могут ли дети влиять на программу? Чем занимаются дети в плохую погоду?',
        },
        {
          title: 'Баланс активностей и отдыха',
          content: 'Оптимальное соотношение: 50% структурированные активности (спорт, кружки, мастер-классы, мероприятия), 30% свободное время (игры по интересам, общение, отдых), 20% обязательные моменты (питание, гигиена, отбой). Признаки перегруженной программы: нет свободного времени, дети жалуются на усталость, мало времени на сон, постоянная беготня и спешка. Признаки недогруженной программы: дети скучают, много бесцельного времени, отсутствие структуры. Идеально: ребенок занят, но не переутомлен, есть время для общения с друзьями, есть выбор между активностью и отдыхом.',
        },
        {
          title: 'Свободное время',
          content: 'Важность свободного времени: дети учатся самоорганизации, строят дружеские отношения, отдыхают от структурированных активностей, занимаются тем, что им действительно интересно. Чем заняться в свободное время: настольные игры, чтение, прогулки по территории, общение с друзьями, спортивные игры (футбол, волейбол), творчество (рисование, музыка), просто "ничегонеделание" (тоже важно!). Вопрос лагерю: Сколько свободного времени в день? Чем дети могут заниматься? Есть ли игротека, библиотека? Разрешены ли гаджеты в свободное время?',
        },
        {
          title: 'Образец идеального расписания',
          content: '08:00 - Подъем, гигиена | 08:30 - Зарядка на свежем воздухе | 09:00 - Завтрак | 09:30 - Утренняя линейка, планы на день | 10:00 - Первый блок активностей (кружки по выбору: спорт, творчество, IT) | 12:00 - Свободное время или подготовка к мероприятиям | 13:00 - Обед | 14:00 - Тихий час (для младших обязательно, для старших — свободное время) | 16:00 - Полдник | 16:30 - Второй блок активностей (спортивные игры, мастер-классы, экскурсии) | 18:30 - Свободное время, игры на территории | 19:00 - Ужин | 19:30 - Вечернее мероприятие (дискотека, концерт, костер, квест) | 21:30 - Второй ужин (кефир, печенье) | 22:00 - "Свечка" (обсуждение дня в отряде) | 22:30 - Отбой для младших | 23:00 - Отбой для старших. Примечание: расписание может варьироваться в зависимости от типа лагеря и дня недели.',
        }
      ]
    }
  },
  {
    id: 'section-7',
    title: 'Стоимость и что в неё входит',
    icon: DollarSign,
    content: {
      intro: 'Стоимость путевки в детский лагерь сильно варьируется в зависимости от региона, типа лагеря, условий проживания и программы. Важно понимать, что именно входит в цену, чтобы избежать неожиданных расходов.',
      subsections: [
        {
          title: 'Средние цены по России (2025 год)',
          content: 'Таблица цен по регионам (за смену 14-21 день): **Подмосковье**: оздоровительные 30-45 тыс. руб., профильные 40-60 тыс. руб., элитные 80-150 тыс. руб. **Краснодарский край/Крым**: оздоровительные 45-70 тыс. руб., профильные 55-85 тыс. руб., элитные 100-200 тыс. руб. **Ленинградская область**: оздоровительные 32-48 тыс. руб., профильные 42-65 тыс. руб. **Алтай/Сибирь**: оздоровительные 35-55 тыс. руб., приключенческие 45-75 тыс. руб. **Карелия**: палаточные 30-50 тыс. руб., приключенческие 40-65 тыс. руб. **Городские (дневные)**: 15-25 тыс. руб. за смену. Факторы, влияющие на цену: локация (море дороже), условия проживания (комфорт), тип программы (профильные дороже), питание (меню), инфраструктура (бассейны, веревочные парки), квалификация персонала.',
        },
        {
          title: 'Что должно быть включено в стоимость',
          content: 'Обязательно входит в путевку: проживание (весь период смены), питание (5-разовое), основная программа (мероприятия, кружки, спорт), работа вожатых и педагогов, медицинское обслуживание, страховка от несчастных случаев, пользование инфраструктурой (бассейн, спортплощадки). Обычно входит, но уточните: трансфер (от города до лагеря и обратно), экскурсии (базовые), расходные материалы для творчества, постельное белье и полотенца, итоговый концерт/мероприятие. Может быть платно дополнительно: экскурсии за пределы лагеря (далекие, дорогие), дополнительные мастер-классы (керамика, верховая езда), фотосессии, сувениры и печатная продукция.',
        },
        {
          title: 'Скрытые расходы',
          content: 'На что еще придется потратиться: карманные деньги ребенку (2-5 тыс. на смену для киоска), медицинские справки (1-3 тыс. руб.), дорога до места сбора группы (если нет трансфера), дополнительная одежда и снаряжение (для специализированных лагерей), сувениры и подарки друзьям по лагерю, дополнительные звонки (если нужны частые), фото и видео со смены (часто продается отдельно, 1-3 тыс. руб.). Совет: заранее узнайте все, что НЕ входит в стоимость, и заложите дополнительный бюджет 5-10 тыс. руб. на непредвиденные расходы.',
        },
        {
          title: 'Государственные компенсации и сертификаты',
          content: 'Способы получить частичную компенсацию: Сертификат дополнительного образования (для профильных лагерей в некоторых регионах, покрывает до 50% стоимости), Компенсация от работодателя (некоторые компании компенсируют путевки детям сотрудников), Путевки от соцзащиты (для малоимущих и многодетных семей, полностью или частично бесплатные), Кэшбэк по программе "Мир" (до 50% при оплате картой "Мир", в рамках государственных программ), Налоговый вычет (13% от стоимости путевки можно вернуть через налоговую, если есть договор и чеки). Как получить: обратитесь в соцзащиту по месту жительства (для льготных категорий), узнайте у работодателя про корпоративные программы, проверьте сайт ФНС для налогового вычета, следите за акциями банков по кэшбэку.',
        }
      ]
    }
  },
  {
    id: 'section-8',
    title: 'Отзывы: как отличить настоящие',
    icon: Star,
    content: {
      intro: 'Отзывы других родителей — ценный источник информации при выборе лагеря. Но не все отзывы одинаково полезны. Важно уметь отличать настоящие отзывы от заказных и объективно оценивать информацию.',
      subsections: [
        {
          title: 'Где искать отзывы',
          content: 'Надежные источники: 1) Независимые сайты-отзовики (Отзовик.ру, IRecommend.ru, Яндекс.Карты, Google Maps). 2) Тематические форумы для родителей (Littleone.ru, U-mama.ru, Eva.ru). 3) Группы в соцсетях (ВКонтакте, Одноклассники — ищите сообщества "Детские лагеря + ваш город"). 4) Личные рекомендации знакомых (самый надежный источник!). 5) Сайт лагеря (с осторожностью, часто модерируются). Ненадежные источники: заказные отзывы на сайте лагеря без возможности проверки, анонимные восторженные отзывы без деталей, отзывы с идентичными формулировками (копипаст). Совет: ищите отзывы минимум на 3-4 разных площадках и сравнивайте.',
        },
        {
          title: 'Красные флаги в отзывах',
          content: 'Признаки проблемного лагеря: 1) Жалобы на безопасность (дети травмируются, уходят с территории, конфликты без решения). 2) Плохое питание (дети голодные, несвежие продукты, однообразное меню). 3) Грубое обращение персонала (вожатые кричат, унижают, не реагируют на жалобы). 4) Антисанитария (грязь, тараканы, плесень, холодная вода). 5) Несоответствие программы заявленной (обещали одно, по факту — другое). 6) Проблемы с возвратом денег (при отмене лагерь не возвращает оплату). 7) Отсутствие медпомощи или реакции на болезнь ребенка. Если видите несколько таких отзывов от разных людей — это серьезный сигнал избегать лагерь!',
        },
        {
          title: 'Как задавать вопросы организаторам',
          content: 'Эффективная стратегия: задавайте конкретные, детальные вопросы (не "хороший ли лагерь?", а "сколько вожатых на отряд?"), просите показать документы и лицензии, спрашивайте про сложные ситуации ("Что делать, если ребенок заболел ночью?"), уточняйте детали программы и быта, запрашивайте контакты родителей прошлых смен (хорошие лагеря дают), не стесняйтесь задавать "неудобные" вопросы про конфликты, травмы, возвраты. Оцените реакцию: хороший лагерь ответит подробно, честно, без раздражения, покажет документы, пригласит на экскурсию. Плохой лагерь: уклоняется от ответов, раздражается, давит ("Не нравится — не берите"), отказывается показывать документы.',
        },
        {
          title: 'Список важных вопросов',
          content: 'Чек-лист вопросов администрации: 1) Есть ли действующие лицензии? Можно ли их увидеть? 2) Сколько лет работает лагерь? Сколько смен в год? 3) Какой опыт у вожатых? Сколько их на отряд? 4) Есть ли врач постоянно? Как далеко больница? 5) Какая охрана? Огорожена ли территория? 6) Что точно входит в стоимость, а что — дополнительно? 7) Каковы условия возврата денег при отмене? 8) Можно ли приехать на экскурсию до покупки путевки? 9) Как организована связь с детьми? 10) Были ли ЧП за последние годы? Как их решали? 11) Можете ли дать контакты родителей прошлых смен? 12) Что делать, если ребенку не понравится и он попросит забрать? Сохраните эти вопросы и задайте их при выборе лагеря!',
        }
      ]
    }
  },
  {
    id: 'section-9',
    title: 'Документы для оформления',
    icon: FileText,
    content: {
      intro: 'Для поездки в лагерь потребуется собрать пакет документов. Начните подготовку заранее, так как некоторые справки имеют ограниченный срок действия.',
      subsections: [
        {
          title: 'Медицинская справка 079/у',
          content: 'Основной медицинский документ для лагеря. Что это: справка о состоянии здоровья ребенка с допуском к пребыванию в детском лагере. Где получить: в поликлинике по месту жительства (у педиатра). Что включает: общий осмотр педиатра, результаты анализов (кровь, моча, кал на яйца глист и энтеробиоз), отметки о прививках, информацию о перенесенных заболеваниях, допуск к физическим нагрузкам и купанию. Срок действия: 3 месяца с даты выдачи. Стоимость: бесплатно по полису ОМС. Время оформления: 1-2 недели (с учетом анализов). Совет: начните оформление за месяц до поездки, чтобы справка была свежей.',
        },
        {
          title: 'Справка об отсутствии контактов (санэпидокружение)',
          content: 'Подтверждает, что ребенок не контактировал с инфекционными больными. Где получить: в поликлинике у педиатра или эпидемиолога. Что указывается: что ребенок не контактировал с больными COVID-19, гриппом, корью, ветрянкой и другими инфекциями. Срок действия: 3 дня (!) перед заездом. Когда получать: за 1-3 дня до отъезда в лагерь (не раньше!). Стоимость: бесплатно по ОМС. Важно: без этой справки ребенка не примут в лагерь, поэтому рассчитайте время получения точно.',
        },
        {
          title: 'Прививочный сертификат и другие справки',
          content: 'Дополнительные медицинские документы: Прививочный сертификат (форма 063): копия карты прививок, подтверждает вакцинацию по национальному календарю, особенно важны: корь, краснуха, паротит, дифтерия, столбняк. Справка от дерматолога: требуется не во всех лагерях, исключает кожные заболевания (лишай, чесотка), действительна 5-7 дней. Анализ на энтеробиоз: соскоб на яйца остриц, требуется для некоторых лагерей, действителен 10 дней. Справка для бассейна: если в лагере есть бассейн, может потребоваться отдельная справка. Уточните в конкретном лагере, какие справки нужны именно вам!',
        },
        {
          title: 'Договор с лагерем и другие документы',
          content: 'Не медицинские документы: Договор с лагерем: внимательно читайте все пункты!, обратите внимание на условия возврата денег, правила поведения и ответственность сторон, подписывается при покупке путевки. Копия свидетельства о рождении или паспорта: для детей до 14 лет — свидетельство о рождении, для 14+ — паспорт, нужна заверенная копия. Копия полиса ОМС: страховой медицинский полис, обязательно! Согласие на обработку персональных данных: стандартная форма от лагеря. Путевка (курсовка): документ, подтверждающий оплату и бронирование места. Доверенность (если ребенка везет не родитель): заверенная нотариально, если ребенка сопровождает бабушка, дядя или другой взрослый.',
        }
      ]
    }
  },
  {
    id: 'section-10',
    title: 'Первый раз в лагере: подготовка',
    icon: Backpack,
    content: {
      intro: 'Первая поездка в лагерь — волнительное событие. Правильная подготовка поможет ребенку чувствовать себя уверенно и избежать многих проблем.',
      subsections: [
        {
          title: 'Психологическая подготовка',
          content: 'Начните разговоры за 2-3 недели: расскажите, что такое лагерь и что там происходит, покажите фотографии и видео, обсудите страхи ребенка (это нормально!), проиграйте возможные ситуации ("Что ты сделаешь, если...?"), познакомьте с правилами и распорядком дня, расскажите о вожатых и их роли. Развивайте навыки самостоятельности: ребенок должен уметь сам одеваться, умываться, чистить зубы, застилать постель, следить за своими вещами, обращаться за помощью к взрослым. Создайте позитивный настрой: говорите о новых друзьях и приключениях, но будьте честны о возможных трудностях, не запугивайте и не идеализируйте, покажите свою уверенность в ребенке.',
        },
        {
          title: 'Что точно нужно взять с собой',
          content: 'Минимальный набор вещей (см. урок 2 для полного списка): Одежда: нижнее белье и носки (по комплекту на день + запас), футболки 5-7 шт., шорты/брюки 3-4, спортивный костюм, теплая кофта, куртка, головной убор. Обувь: кроссовки, сандалии, тапочки для душа. Гигиена: зубная щетка и паста, мыло/гель, шампунь, расческа, полотенце 2 шт. Купание: купальник/плавки 2 шт., полотенце. Документы: все справки в папке, копии паспорта/свидетельства. Полезное: фонарик, бутылка для воды, небольшой рюкзак. Совет: собирайте чемодан вместе с ребенком, чтобы он знал, где что лежит!',
        },
        {
          title: 'Что брать нельзя',
          content: 'Запрещенные вещи в большинстве лагерей: Дорогие вещи: украшения, дорогая техника (планшеты, ноутбуки), брендовая одежда (может потеряться или испортиться). Опасное: ножи и острые предметы (кроме маникюрных ножниц в чехле), зажигалки и спички, лекарства без согласования с врачом, пиротехника. Продукты: скоропортящиеся (молочка, колбаса), домашние заготовки, алкоголь (для подростков — строжайший запрет!). Другое: ценные коллекции, большие суммы денег (достаточно 2-3 тыс. руб.). Гаджеты: во многих лагерях телефоны либо запрещены, либо ограничены по времени использования. Уточните правила конкретного лагеря!',
        },
        {
          title: 'Шаблон списка вещей',
          content: 'Распечатайте и отмечайте при сборе: □ Нижнее белье ___ шт. □ Носки ___ пар □ Футболки ___ шт. □ Шорты/брюки ___ шт. □ Спортивный костюм □ Джинсы/плотные брюки □ Теплая кофта/толстовка □ Куртка/ветровка □ Головной убор □ Кроссовки □ Сандалии/сланцы □ Тапочки для душа □ Купальник/плавки ___ шт. □ Полотенце для пляжа □ Полотенце банное □ Зубная щетка и паста □ Мыло/гель для душа □ Шампунь □ Расческа/щетка □ Дезодорант □ Солнцезащитный крем □ Крем от комаров □ Влажные салфетки □ Все медицинские справки □ Копия свидетельства/паспорта □ Копия полиса ОМС □ Договор с лагерем □ Фонарик □ Бутылка для воды □ Рюкзак для походов □ Карманные деньги. Совет: подпишите все вещи несмываемым маркером!',
        }
      ]
    }
  },
  {
    id: 'section-11',
    title: 'Связь с ребенком',
    icon: Phone,
    content: {
      intro: 'Правильная организация связи с ребенком во время смены важна для спокойствия родителей и комфорта ребенка. Важно найти баланс между контролем и свободой.',
      subsections: [
        {
          title: 'Телефоны и гаджеты: правила',
          content: 'Три основных подхода в лагерях: Полный запрет: телефоны сдаются при заезде и выдаются при выезде, дети пользуются стационарными телефонами лагеря в определенные часы. Плюсы: полное погружение в лагерную жизнь, дети не отвлекаются. Минусы: родители беспокоятся. Ограниченное использование: телефоны выдаются в определенные часы (обычно вечером на 1-2 часа), остальное время хранятся у вожатых. Плюсы: баланс между связью и погружением. Минусы: дети могут забыть позвонить. Свободное использование: ребенок сам распоряжается телефоном, но есть ограничения (нельзя на мероприятиях, в столовой). Плюсы: свобода. Минусы: дети "залипают" в телефоны, меньше общаются вживую. Наша рекомендация: ограниченное использование — оптимальный вариант для большинства случаев.',
        },
        {
          title: 'Родительские дни',
          content: 'Что это: день (обычно в середине смены), когда родители могут приехать в лагерь. Программа: экскурсия по территории, знакомство с вожатыми, концерт или выступление детей, совместный обед (иногда), возможность пообщаться с ребенком. Нужно ли приезжать: если ребенок адаптировался хорошо — да, это будет приятно обоим, если адаптация сложная — может усилить желание уехать домой, если живете далеко — не обязательно, ребенок поймет. Что можно привезти: любимые лакомства (согласуйте с администрацией!), свежие фрукты, сок, печенье, небольшие подарки (книга, настольная игра). Что нельзя: скоропортящиеся продукты, газировку и чипсы, слишком много сладкого, дорогие подарки (вызовет зависть у других детей).',
        },
        {
          title: 'Онлайн-трансляции и фотоотчеты',
          content: 'Современные способы связи: Группы в соцсетях: многие лагеря создают закрытые группы для родителей, публикуют фото и видео с мероприятий ежедневно, родители видят, чем занят ребенок. Онлайн-камеры: некоторые лагеря устанавливают камеры на территории, родители могут онлайн смотреть за детьми (спорный вопрос: контроль vs свобода). Фотосессии: профессиональные фотографы снимают детей, фото продаются после смены (или включены в стоимость). Видеодневники: вожатые снимают короткие ролики о жизни отряда. Совет: не переусердствуйте с наблюдением — дайте ребенку свободу, но будьте в курсе происходящего в общих чертах.',
        },
        {
          title: 'Как часто звонить',
          content: 'Рекомендации психологов: Первые 2-3 дня: можно звонить ежедневно для поддержки (если лагерь разрешает), короткие звонки 5-10 минут, главное — выслушать и подбодрить. С 4-5 дня: сократить до 1 звонка в 2-3 дня, дать ребенку адаптироваться. Со второй недели: 1-2 звонка в неделю достаточно, если ребенок сам не звонит — это хороший знак! Почему не стоит звонить часто: мешает адаптации, ребенок постоянно думает о доме, не может погрузиться в лагерную жизнь, усиливает тоску. Идеально: договоритесь заранее о графике звонков и придерживайтесь его. Если ребенок просит позвонить реже — это отлично, значит ему интересно!',
        }
      ]
    }
  },
  {
    id: 'section-12',
    title: 'Проблемы и их решение',
    icon: AlertTriangle,
    content: {
      intro: 'Даже в лучших лагерях могут возникнуть проблемы. Важно знать, как на них реагировать и когда вмешиваться.',
      subsections:
        {
          title: 'Когда забирать ребенка раньше срока',
          content: 'Уважительные причины досрочного выезда: серьезная болезнь ребенка, требующая лечения дома, семейные обстоятельства (болезнь родственника, похороны), действительно невыносимые условия в лагере (антисанитария, опасность), систематический буллинг, который администрация не может решить, категорический отказ ребенка находиться в лагере более 7 дней. Неуважительные причины: легкая простуда, которую можно вылечить на месте, временная тоска по дому в первые 2-3 дня, небольшой конфликт с ребенком, капризы ("мне скучно", "хочу домой"), желание родителей увидеть ребенка. Финансовые последствия: при досрочном выезде по желанию возврат пропорционален неиспользованным дням (но не всегда!), вычитаются организационные расходы, читайте договор внимательно! Психологические последствия: досрочный выезд без веской причины = негативный опыт, ребенок может бояться новых поездок, важно довести начатое до конца (если нет опасности).',
        }
      ]
    }
  }
]

export default async function GuidePage() {
  const supabase = await createServerSupabaseClient()
  
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    redirect('/login')
  }

  // Получаем закладки пользователя
  const { data: bookmarks } = await supabase
    .from('bookmarks')
    .select('*')
    .eq('user_id', user.id)

  const bookmarkedSections = bookmarks?.map(b => b.guide_section) || []

  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar user={user} />
      
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        {/* Заголовок */}
        <div className="mb-12">
          <Link 
            href="/dashboard" 
            className="inline-flex items-center text-primary-600 hover:text-primary-700 mb-4 transition-colors"
          >
            ← Вернуться в личный кабинет
          </Link>
          
          <div className="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6 mb-8">
            <div className="flex-1">
              <h1 className="text-4xl md:text-5xl font-display font-bold text-gray-900 mb-4">
                Выбираем лагерь правильно
              </h1>
              <p className="text-xl text-gray-600 mb-6">
                Полный гид для родителей по выбору детского лагеря в России. 
                12 подробных разделов с практическими советами от экспертов ООО Резорт-Юг.
              </p>
              
              <div className="flex flex-wrap gap-3">
                <span className="px-3 py-1 bg-blue-100 text-blue-700 text-sm font-medium rounded-full">
                  12 разделов
                </span>
                <span className="px-3 py-1 bg-green-100 text-green-700 text-sm font-medium rounded-full">
                  {bookmarkedSections.length} закладок
                </span>
              </div>
            </div>

            <div className="flex flex-col sm:flex-row gap-3">
              <GuideSearch sections={sections} />
              <ExportPDF />
            </div>
          </div>
        </div>

        {/* Навигация по разделам */}
        <Card className="p-6 mb-8 bg-gradient-to-r from-blue-50 to-cyan-50">
          <h2 className="text-xl font-bold text-gray-900 mb-4">Содержание</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
            {sections.map((section, index) => (
              <a
                key={section.id}
                href={`#${section.id}`}
                className="flex items-center p-3 rounded-lg hover:bg-white/80 transition-colors group"
              >
                <div className="w-10 h-10 bg-gradient-primary rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                  <section.icon className="w-5 h-5 text-white" />
                </div>
                <div>
                  <div className="text-sm text-gray-500">Раздел {index + 1}</div>
                  <div className="font-semibold text-gray-900 group-hover:text-primary-600 transition-colors">
                    {section.title}
                  </div>
                </div>
              </a>
            ))}
          </div>
        </Card>

        {/* Разделы гида */}
        <div className="space-y-12">
          {sections.map((section, index) => (
            <section key={section.id} id={section.id} className="scroll-mt-20">
              <Card className="p-8 md:p-12">
                {/* Заголовок раздела */}
                <div className="flex items-start justify-between mb-6">
                  <div className="flex items-start gap-4 flex-1">
                    <div className="w-14 h-14 bg-gradient-primary rounded-xl flex items-center justify-center flex-shrink-0">
                      <section.icon className="w-7 h-7 text-white" />
                    </div>
                    <div>
                      <div className="text-sm font-semibold text-primary-600 mb-2">
                        Раздел {index + 1} из 12
                      </div>
                      <h2 className="text-3xl font-display font-bold text-gray-900 mb-3">
                        {section.title}
                      </h2>
                    </div>
                  </div>
                  <BookmarkButton 
                    sectionId={section.id} 
                    isBookmarked={bookmarkedSections.includes(section.id)}
                  />
                </div>

                {/* Контент раздела */}
                <div className="prose prose-lg max-w-none">
                  <p className="text-xl text-gray-700 leading-relaxed mb-8">
                    {section.content.intro}
                  </p>

                  {section.content.subsections.map((subsection, subIndex) => (
                    <div key={subIndex} className="mb-8">
                      <h3 className="text-2xl font-bold text-gray-900 mb-4">
                        {subsection.title}
                      </h3>
                      <div className="text-gray-700 leading-relaxed whitespace-pre-line">
                        {subsection.content}
                      </div>
                      {subsection.examples && (
                        <div className="mt-3 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                          <p className="text-sm text-blue-900 italic">{subsection.examples}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </Card>
            </section>
          ))}
        </div>

        {/* Заключение */}
        <Card className="p-8 mt-12 bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200">
          <div className="text-center">
            <div className="text-5xl mb-4">🎉</div>
            <h2 className="text-3xl font-bold text-gray-900 mb-4">
              Поздравляем!
            </h2>
            <p className="text-lg text-gray-700 max-w-2xl mx-auto mb-6">
              Вы изучили полный гид по выбору детского лагеря. Теперь вы готовы сделать 
              осознанный выбор и подарить ребенку незабываемое лето!
            </p>
            <div className="flex flex-wrap justify-center gap-4">
              <Button variant="accent" asChild>
                <Link href="/mini-course">
                  Пройти мини-курс
                </Link>
              </Button>
              <Button variant="outline" asChild>
                <Link href="/dashboard">
                  В личный кабинет
                </Link>
              </Button>
            </div>
          </div>
        </Card>

        {/* Контакты */}
        <Card className="p-6 mt-8 bg-gray-100">
          <h3 className="font-bold text-gray-900 mb-3">Остались вопросы?</h3>
          <p className="text-gray-700 mb-4">
            Команда ООО Резорт-Юг всегда готова помочь с выбором лагеря. 
            Свяжитесь с нами для индивидуальной консультации.
          </p>
          <div className="flex flex-wrap gap-4">
            <Button size="sm" variant="primary">
              Связаться с нами
            </Button>
            <Button size="sm" variant="outline" asChild>
              <a href="https://resort-south.ru" target="_blank" rel="noopener noreferrer">
                Посетить наш сайт
              </a>
            </Button>
          </div>
        </Card>
      </main>
    </div>
  )
}
